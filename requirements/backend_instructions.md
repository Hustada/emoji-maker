# Project Overview
Use this guide to build backend for the web app of emoji maker.

# Tech Stack
- We will use Next.js, Supabase, Clerk

# Tables & buckets already created
Supabase storage bucket: "emojis"


TABLEprofiles (
    user_id TEXT PRIMARY KEY,
    credits INTEGER DEFAULT 3 NOT NULL,
    tier TEXT NOT NULL DEFAULT 'free' CHECK (tier IN ('free', 'pro')),
    stripe_customer_id TEXT,
    stripe_subscription_id TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP NOT NULL
);

TABLE emojis (
    id BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
    image_url TEXT NOT NULL,
    prompt TEXT NOT NULL,
    likes_count NUMERIC DEFAULT 0,
    creator_user_id TEXT NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

# Requirements
1. Create user to user table
--- 1. After a user signin via clerk, we should get the userId from clerk, and check if this userId exists in 'profiles' table, matching 'user_id'
--- 2. If the user does not exist, we should create a new user in 'profiles' table.
--- 3. If the user exists, then proceed, and pass on the user_id to functions like generate emojis

2. Upload emoji to "emojis" supabase storage bucket;
--- 1. When user generating an emoji, upload the emoji image file returned from Replicate to supabase "emojis" storage bucket.
--- 2. Add the image url to the "emojis" data table as "image_url", and creator_user_id to be the actual user_id.

3. Display all images in emojigrid
--- 1. Emoji grid should fetch and display all images from "emojis" data table.
--- 2. When a new emoji is generated, the emoji grid should update automatically to add the new emoji to the grid.

4. Like an emoji
--- 1. When a user clicks on the 'like' button, the num_likes count should increase on the emojis table.
--- 2. When a user clicks on the 'like' button, the num_likes count should decrease on the emojis table.

# Documentation
## Example of uploading files to supabase storage bucket
import { createClient } from '@supabase/supabase-js'

// Create a Supabase client
const supabase = createClient('your_project_url', 'your_supabase_api_key' );

// Upload a file using standard upload method
async function uploadFile(file) {
    const { data, error } = await supabase.storage.from('bucket_name').upload('file_path', file);
    if (error) {
        // handle error
    } else {
        // handle success
    }
}